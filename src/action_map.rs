use anyhow::Result;
use strum_macros::{Display, EnumIter, EnumString};

use crate::config::Colors;
use crate::event_exec::{EventAction, LeaveMode};
use crate::status::Status;

/// Different kind of action which can be mapped to a key.
/// All those actions are mapped to a key and this enum
/// makes the junction between received Key events and
/// actions in the application.
#[derive(Clone, Debug, Display, EnumString, EnumIter)]
pub enum ActionMap {
    Back,
    BackTab,
    Backspace,
    Bulk,
    Chmod,
    ClearFlags,
    CliInfo,
    Command,
    Compress,
    CopyFilename,
    CopyFilepath,
    CopyPaste,
    CutPaste,
    Delete,
    DeleteFile,
    Diff,
    DragNDrop,
    EncryptedDrive,
    End,
    Enter,
    Exec,
    Filter,
    FlagAll,
    FuzzyFind,
    FuzzyFindHelp,
    FuzzyFindLine,
    GoRoot,
    GoStart,
    Goto,
    Help,
    History,
    Home,
    Jump,
    KeyHome,
    Log,
    MarksJump,
    MarksNew,
    MediaInfo,
    MocpAddToPlayList,
    MocpGoToSong,
    MocpNext,
    MocpPrevious,
    MocpTogglePause,
    MoveDown,
    MoveLeft,
    MoveRight,
    MoveUp,
    NewDir,
    NewFile,
    Nothing,
    NvimFilepicker,
    NvimSetAddress,
    OpenConfig,
    OpenFile,
    PageDown,
    PageUp,
    Preview,
    Quit,
    RefreshView,
    RegexMatch,
    Rename,
    ResetMode,
    ReverseFlags,
    Search,
    SearchNext,
    SetWallpaper,
    Shell,
    ShellCommand,
    ShellMenu,
    Shortcut,
    Sort,
    Symlink,
    Tab,
    ToggleDisplayFull,
    ToggleDualPane,
    ToggleFlag,
    ToggleHidden,
    TogglePreviewSecond,
    TrashEmpty,
    TrashMoveFile,
    TrashOpen,
    TrashRestoreFile,
    Tree,
    TreeFold,
    TreeFoldAll,
    TreeUnFoldAll,
    Custom(String),
}

impl ActionMap {
    /// Makes the junction between `Actions` and `Events`.
    /// Every Action links to a different `EventExec` method.
    pub fn matcher(&self, status: &mut Status, colors: &Colors) -> Result<()> {
        let current_tab = status.selected();
        match self {
            ActionMap::Back => EventAction::event_back(status, colors),
            ActionMap::BackTab => EventAction::event_backtab(status),
            ActionMap::Backspace => EventAction::event_backspace(status),
            ActionMap::Bulk => EventAction::event_bulk(status),
            ActionMap::Chmod => EventAction::event_chmod(status),
            ActionMap::ClearFlags => EventAction::event_clear_flags(status),
            ActionMap::CliInfo => EventAction::event_cli_info(status),
            ActionMap::Command => EventAction::event_command(current_tab),
            ActionMap::Compress => EventAction::event_compress(status),
            ActionMap::CopyFilename => EventAction::event_copy_filename(status),
            ActionMap::CopyFilepath => EventAction::event_copy_filepath(status),
            ActionMap::CopyPaste => EventAction::event_copy_paste(status),
            ActionMap::CutPaste => EventAction::event_cut_paste(status),
            ActionMap::Delete => EventAction::event_delete(status),
            ActionMap::DeleteFile => EventAction::event_delete_file(status),
            ActionMap::Diff => EventAction::event_diff(status),
            ActionMap::DragNDrop => EventAction::event_drag_n_drop(status),
            ActionMap::EncryptedDrive => EventAction::event_encrypted_drive(status),
            ActionMap::End => EventAction::event_end(status, colors),
            ActionMap::Enter => EventAction::event_enter(status, colors),
            ActionMap::Exec => EventAction::event_exec(current_tab),
            ActionMap::Filter => EventAction::event_filter(current_tab),
            ActionMap::FlagAll => EventAction::event_flag_all(status),
            ActionMap::FuzzyFind => EventAction::event_fuzzyfind(status),
            ActionMap::FuzzyFindHelp => EventAction::event_fuzzyfind_help(status),
            ActionMap::FuzzyFindLine => EventAction::event_fuzzyfind_line(status),
            ActionMap::GoRoot => EventAction::event_go_root(current_tab),
            ActionMap::GoStart => EventAction::event_go_start(status),
            ActionMap::Goto => EventAction::event_goto(current_tab),
            ActionMap::Help => EventAction::event_help(status),
            ActionMap::History => EventAction::event_history(current_tab),
            ActionMap::Home => EventAction::event_home(current_tab),
            ActionMap::Jump => EventAction::event_jump(status),
            ActionMap::KeyHome => EventAction::event_key_home(status, colors),
            ActionMap::Log => EventAction::event_log(current_tab),
            ActionMap::MarksJump => EventAction::event_marks_jump(status),
            ActionMap::MarksNew => EventAction::event_marks_new(current_tab),
            ActionMap::MediaInfo => EventAction::event_mediainfo(current_tab),
            ActionMap::MocpAddToPlayList => EventAction::event_mocp_add_to_playlist(current_tab),
            ActionMap::MocpGoToSong => EventAction::event_mocp_go_to_song(current_tab),
            ActionMap::MocpNext => EventAction::event_mocp_next(),
            ActionMap::MocpPrevious => EventAction::event_mocp_previous(),
            ActionMap::MocpTogglePause => EventAction::event_mocp_toggle_pause(status),
            ActionMap::MoveDown => EventAction::event_move_down(status, colors),
            ActionMap::MoveLeft => EventAction::event_move_left(status, colors),
            ActionMap::MoveRight => EventAction::event_move_right(status, colors),
            ActionMap::MoveUp => EventAction::event_move_up(status, colors),
            ActionMap::NewDir => EventAction::event_new_dir(current_tab),
            ActionMap::NewFile => EventAction::event_new_file(current_tab),
            ActionMap::NvimFilepicker => EventAction::event_nvim_filepicker(status),
            ActionMap::NvimSetAddress => EventAction::event_set_nvim_server(status),
            ActionMap::OpenConfig => EventAction::event_open_config(status),
            ActionMap::OpenFile => EventAction::event_open_file(status),
            ActionMap::PageDown => EventAction::event_page_down(status, colors),
            ActionMap::PageUp => EventAction::event_page_up(status, colors),
            ActionMap::Preview => EventAction::event_preview(status, colors),
            ActionMap::Quit => EventAction::event_quit(current_tab),
            ActionMap::RefreshView => EventAction::event_refreshview(status, colors),
            ActionMap::RegexMatch => EventAction::event_regex_match(current_tab),
            ActionMap::Rename => EventAction::event_rename(current_tab),
            ActionMap::ResetMode => EventAction::event_reset_mode(current_tab),
            ActionMap::ReverseFlags => EventAction::event_reverse_flags(status),
            ActionMap::Search => EventAction::event_search(current_tab),
            ActionMap::SearchNext => EventAction::event_search_next(current_tab),
            ActionMap::SetWallpaper => EventAction::event_set_wallpaper(current_tab),
            ActionMap::Shell => EventAction::event_shell(status),
            ActionMap::ShellCommand => EventAction::event_shell_command(current_tab),
            ActionMap::ShellMenu => EventAction::event_shell_menu(current_tab),
            ActionMap::Shortcut => EventAction::event_shortcut(current_tab),
            ActionMap::Sort => EventAction::event_sort(current_tab),
            ActionMap::Symlink => EventAction::event_symlink(status),
            ActionMap::Tab => EventAction::event_tab(status),
            ActionMap::ToggleDisplayFull => EventAction::event_toggle_display_full(status),
            ActionMap::ToggleDualPane => EventAction::event_toggle_dualpane(status),
            ActionMap::ToggleFlag => EventAction::event_toggle_flag(status),
            ActionMap::ToggleHidden => EventAction::event_toggle_hidden(status, colors),
            ActionMap::TogglePreviewSecond => EventAction::event_toggle_preview_second(status),
            ActionMap::TrashEmpty => EventAction::event_trash_empty(status),
            ActionMap::TrashMoveFile => EventAction::event_trash_move_file(status),
            ActionMap::TrashOpen => EventAction::event_trash_open(status),
            ActionMap::TrashRestoreFile => LeaveMode::trash(status),
            ActionMap::Tree => EventAction::event_tree(status, colors),
            ActionMap::TreeFold => EventAction::event_tree_fold(current_tab, colors),
            ActionMap::TreeFoldAll => EventAction::event_tree_fold_all(current_tab, colors),
            ActionMap::TreeUnFoldAll => EventAction::event_tree_unfold_all(current_tab, colors),
            ActionMap::Custom(string) => EventAction::event_custom(status, string.clone()),

            ActionMap::Nothing => Ok(()),
        }
    }
}
